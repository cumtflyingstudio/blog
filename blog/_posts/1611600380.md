---
title: Vue3ä½¿ç”¨Mittæ›¿ä»£EventBus
date: 2020-12-29
tags:
  - Vue3
  - Mitt
  - EventBus
author: ç‹æ˜­å›
location: å¾å·
summary: å°¤é›¨æºªæ–°æ´»ï¼Œå‰ç«¯å­¦ä¸åŠ¨äº†ï¼Ÿ
---

![](https://b3logfile.com/bing/20191129.jpg?imageView2/1/w/960/h/540/interlace/1/q/100)

## å‰è¨€

å‰æ®µæ—¶é—´æ¥è§¦äº† Vueï¼Œä½œä¸ºä¸€ä¸ª~~åˆæ ¼~~çš„å‰ç«¯ï¼Œæµè¡Œçš„æ¡†æ¶è¿˜æ˜¯å¾—ä¼šç‚¹çš„

ä¸è¿‡ä¸€ç›´å¬è¯´ Vue å¼€ç®±å³ç”¨ï¼Œ`VueX`ã€`Vue Router`ã€`Event Bus`ä¸€å †ç°æˆçš„ç©æ„ï¼Œç„¶è€Œæ¥è§¦äº† Vue3 æ‰å‘ç°ï¼ŒEventBus è¢«å»æ‰äº†ï¼Ÿï¼Ÿï¼Ÿ

è¿™æ€ä¹ˆå¯ä»¥ï¼ˆæš‚æ—¶ä¸æ `Composition API`ï¼Œæˆ‘èœé¸¡è¿˜æ²¡å­¦ä¼šã€‚ã€‚ã€‚ï¼‰ï¼Ÿ

## Mitt

[Mitt](https://github.com/developit/mitt)æ˜¯ä¸€ä¸ªä½“ç§¯æå°çš„ç¬¬ä¸‰æ–¹æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…å¼ JavaScript åº“

å®˜æ–¹æ–‡æ¡£æ˜¯ä¸æ¡†æ¶æ— å…³çš„ï¼Œæ‰€ä»¥è¿™ä¸ªç©æ„å…¶å® Reactã€Vue éƒ½å¯ä»¥ç”¨

æœ¬æ–‡ä»¥ Vue3 ä¸ºä¾‹ï¼Œä»‹ç» Mitt åº“çš„å¯¼å…¥å’Œä½¿ç”¨

### å‡†å¤‡

åˆ©ç”¨ vue è„šæ‰‹æ¶åˆ›å»ºä¸€ä¸ª vue3 é¡¹ç›®ï¼Œä¸ä½¿ç”¨ TypeScript

åœ¨è¿™é‡Œï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨

```shell
$ vue ui
```

å‘½ä»¤ï¼Œæ‰“å¼€ä¸€ä¸ªå›¾å½¢åŒ–é¡µé¢æ¥åˆ›å»ºé¡¹ç›®

åœ¨è¿™é‡Œï¼Œé¡¹ç›®å‘½åä¸º `example`
![image.png](https://b3logfile.com/file/2020/12/image-fe355f04.png)

é€‰æ‹© Vue3 æ¨¡æ¿ååˆ›å»ºé¡¹ç›®

![image.png](https://b3logfile.com/file/2020/12/image-04878b81.png)

ç¨ç­‰å‡ åˆ†é’Ÿåï¼Œåˆ›å»ºå®Œæˆï¼Œç”¨ç¼–è¾‘å™¨æˆ– IDE æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹

![image.png](https://b3logfile.com/file/2020/12/image-1e5fb656.png)

è¿™æ ·ä¸€ä¸ª Vue3 çš„é¡¹ç›®å°±åˆ›å»ºå¥½äº†

### å®‰è£…

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

```shell
$ npm i mitt --save
```

### å¯¼å…¥

1.

åœ¨ `src/`ä¸‹æ–°å»ºä¸€ä¸ª `bus.js`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```javascript
/* bus.js */

import mitt from 'mitt'

const bus = {}
const emitter = mitt()

bus.$on = emitter.on
bus.$off = emitter.off
bus.$emit = emitter.emit

export default bus
```

è¿™æ®µä»£ç å¼•å…¥äº† mittï¼Œå¹¶åˆ©ç”¨ mitt()æ„é€ å™¨ç”Ÿæˆäº†ä¸€ä¸ª emit å®ä¾‹ï¼ŒåŒæ—¶æŠŠ `on`ã€`off`å’Œ `emit`æ–¹æ³•èµ‹å€¼ç»™äº†ç©ºå¯¹è±¡ `bus`ï¼Œä½œä¸ºé™æ€æ–¹æ³•

2.

æ‰“å¼€ `src/main.js`å†…å®¹å¦‚ä¸‹ï¼š

```javascript
/* main.js */

import { createApp } from 'vue'
import App from './App.vue'

createApp(App).mount('#app')
```

æ”¹é€  `main.js`ï¼Œå¯¼å…¥åˆšæ‰çš„ `bus`å¯¹è±¡ï¼Œå¹¶æŒ‚è½½åˆ°å…¨å±€
æ”¹é€ åçš„ `main.js`ï¼š

```javascript
/* main.js */

import { createApp } from 'vue'
import App from './App.vue'
import bus from './bus'

const app = createApp(App)

app.config.globalProperties.$bus = bus

app.mount('#app')
```

### ä½¿ç”¨

è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨çˆ¶ã€å­ç»„ä»¶é—´é€šè¿‡åˆšæ‰æŒ‚è½½çš„å…¨å±€å¯¹è±¡ `$bus`æ¥è¿›è¡Œäº‹ä»¶ä¼ é€’ï¼Œå¹¶ä½¿ç”¨ Vue3 æ–°å¢çš„ `reactive`æ¥å®ç°ä¸€ä¸ªå“åº”å¼ç»„ä»¶

#### æ”¹é€ 

æ”¹é€ é»˜è®¤æ¨¡æ¿é‡Œçš„ `src/App.vue`å’Œ `src/components/HelloWorld.vue`ï¼Œæ”¹é€ åçš„ `App.vue`ï¼š

```html
<template>
  <img alt="Vue logo" src="./assets/logo.png" />
  <button @click="handleClick()">è¿™æ˜¯ä¸€ä¸ªæŒ‰é’®</button>
  <HelloWorld msg="Welcome to Your Vue.js App" />
</template>

<script>
  import HelloWorld from './components/HelloWorld.vue'

  export default {
    name: 'App',
    components: {
      HelloWorld,
    },
    methods: {
      handleClick() {
        this.$bus.$emit('click')
      },
    },
  }
</script>

<style>
  #app {
    font-family: Avenir, Helvetica, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-align: center;
    color: #2c3e50;
    margin-top: 60px;
  }
</style>
```

æ”¹é€ åçš„ `HelloWorld.vue`ï¼š

```html
<template>
  <div class="hello">
    <h1>{{ msg }}</h1>
    <p>
      For a guide and recipes on how to configure / customize this project,<br />
      check out the
      <a href="https://cli.vuejs.org" target="_blank" rel="noopener"
        >vue-cli documentation</a
      >.
    </p>
    <h3>Installed CLI Plugins</h3>
    <ul>
      <li v-for="i in links" :key="i.text">
        <a href="{{i.link}}" target="_blank" rel="noopener">{{ i.text }}</a>
      </li>
    </ul>
    <h3>Essential Links</h3>
    <ul>
      <li>
        <a href="https://vuejs.org" target="_blank" rel="noopener">Core Docs</a>
      </li>
      <li>
        <a href="https://forum.vuejs.org" target="_blank" rel="noopener"
          >Forum</a
        >
      </li>
      <li>
        <a href="https://chat.vuejs.org" target="_blank" rel="noopener"
          >Community Chat</a
        >
      </li>
      <li>
        <a href="https://twitter.com/vuejs" target="_blank" rel="noopener"
          >Twitter</a
        >
      </li>
      <li>
        <a href="https://news.vuejs.org" target="_blank" rel="noopener">News</a>
      </li>
    </ul>
    <h3>Ecosystem</h3>
    <ul>
      <li>
        <a href="https://router.vuejs.org" target="_blank" rel="noopener"
          >vue-router</a
        >
      </li>
      <li>
        <a href="https://vuex.vuejs.org" target="_blank" rel="noopener">vuex</a>
      </li>
      <li>
        <a
          href="https://github.com/vuejs/vue-devtools#vue-devtools"
          target="_blank"
          rel="noopener"
          >vue-devtools</a
        >
      </li>
      <li>
        <a href="https://vue-loader.vuejs.org" target="_blank" rel="noopener"
          >vue-loader</a
        >
      </li>
      <li>
        <a
          href="https://github.com/vuejs/awesome-vue"
          target="_blank"
          rel="noopener"
          >awesome-vue</a
        >
      </li>
    </ul>
  </div>
</template>

<script>
  import { reactive } from 'vue'

  export default {
    name: 'HelloWorld',
    props: {
      msg: String,
    },
    setup() {
      const links = reactive([
        {
          link:
            'https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-babel',
          text: 'babel',
        },
        {
          link:
            'https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-eslint',
          text: 'eslint',
        },
      ])
      const add = () =>
        links.push({
          link: 'https://github.com/developit/mitt',
          text: 'mitt',
        })
      return { links, add }
    },
    mounted() {
      this.$bus.$on('click', this.add)
    },
  }
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
  h3 {
    margin: 40px 0 0;
  }

  ul {
    list-style-type: none;
    padding: 0;
  }

  li {
    display: inline-block;
    margin: 0 10px;
  }

  a {
    color: #42b983;
  }
</style>
```

#### æ•ˆæœ

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```shell
$ npm run serve
```

æ‰“å¼€æµè§ˆå™¨åˆ°ç›¸åº”çš„ url æŸ¥çœ‹é¡µé¢
![image.png](https://b3logfile.com/file/2020/12/image-b5b2f5ec.png)

ç‚¹å‡»æŒ‰é’®ï¼Œå‘ç°â€œInstalled CLI Pluginsâ€ä¸‹é¢å¢åŠ äº†ä¸€ä¸ªâ€œmittâ€
![image.png](https://b3logfile.com/file/2020/12/image-39f2e004.png)

## æ€»ç»“

è‡ªæ­¤ï¼Œæœ¬ç¯‡æ–‡ç« å°±ç»“æŸäº†ï¼Œç›¸å…³ä»£ç å·²ä¸Šä¼ è‡³ Githubï¼š[Suvern/vue3-mitt-example](https://github.com/Suvern/vue3-mitt-example)æä¾›å‚è€ƒ

Vue3 çš„æ›´æ–°ï¼Œè®©å¾ˆå¤šç¨‹åºå‘˜æ„Ÿæ…¨ï¼šâ€œå­¦ä¸åŠ¨äº†â€

ä¸è¿‡æˆ‘è®¤ä¸ºï¼Œæ•²ä»£ç çš„ä¹è¶£æ›´å¤šçš„åœ¨äºå­¦ä¹ å’Œå‘ç°æ–°ä¸œè¥¿

åœ¨ç¼–å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘å› ä¸ºæœ€è¿‘å¼€å‘ä¸€ä¸ª Vue3 çš„é¡¹ç›®æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œç„¶è€Œå›½å†…æœåˆ°å…³äº `VueX`å’Œ `Vue Router`ä¹‹ç±»çš„æ•™ç¨‹å’Œæ–‡ç« éƒ½æ˜¯ä½¿ç”¨ Vue2.xï¼Œå†…å®¹ä¹Ÿå‚å·®ä¸é½ï¼Œæ‰€ä»¥æ€’æŸ¥æ–‡æ¡£ï¼Œç»“æœè¿˜æ˜¯ä»å®˜æ–¹æ¨¡æ¿é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆ

æ‰€ä»¥è¿˜æ˜¯å­¦å§ ğŸ™ƒğŸ™ƒğŸ™ƒ
